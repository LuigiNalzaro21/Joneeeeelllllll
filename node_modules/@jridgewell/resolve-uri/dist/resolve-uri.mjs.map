{"version":3,"file":"resolve-uri.mjs","sources":["../src/resolve-uri.ts"],"sourcesContent":["// Matches the scheme of a URL, eg \"http://\"\nconst schemeRegex = /^[\\w+.-]+:\\/\\//;\n\n/**\n * Matches the parts of a URL:\n * 1. Scheme, including \":\", guaranteed.\n * 2. User/password, including \"@\", optional.\n * 3. Host, guaranteed.\n * 4. Port, including \":\", optional.\n * 5. Path, including \"/\", optional.\n * 6. Query, including \"?\", optional.\n * 7. Hash, including \"#\", optional.\n */\nconst urlRegex = /^([\\w+.-]+:)\\/\\/([^@/#?]*@)?([^:/#?]*)(:\\d+)?(\\/[^#?]*)?(\\?[^#]*)?(#.*)?/;\n\n/**\n * File URLs are weird. They dont' need the regular `//` in the scheme, they may or may not start\n * with a leading `/`, they can have a domain (but only if they don't start with a Windows drive).\n *\n * 1. Host, optional.\n * 2. Path, which may include \"/\", guaranteed.\n * 3. Query, including \"?\", optional.\n * 4. Hash, including \"#\", optional.\n */\nconst fileRegex = /^file:(?:\\/\\/((?![a-z]:)[^/#?]*)?)?(\\/?[^#?]*)(\\?[^#]*)?(#.*)?/i;\n\ntype Url = {\n  scheme: string;\n  user: string;\n  host: string;\n  port: string;\n  path: string;\n  query: string;\n  hash: string;\n  type: UrlType;\n};\n\nconst enum UrlType {\n  Empty = 1,\n  Hash = 2,\n  Query = 3,\n  RelativePath = 4,\n  AbsolutePath = 5,\n  SchemeRelative = 6,\n  Absolute = 7,\n}\n\nfunction isAbsoluteUrl(input: string): boolean {\n  return schemeRegex.test(input);\n}\n\nfunction isSchemeRelativeUrl(input: string): boolean {\n  return input.startsWith('//');\n}\n\nfunction isAbsolutePath(input: string): boolean {\n  return input.startsWith('/');\n}\n\nfunction isFileUrl(input: string): boolean {\n  return input.startsWith('file:');\n}\n\nfunction isRelative(input: string): boolean {\n  return /^[.?#]/.test(input);\n}\n\nfunction parseAbsoluteUrl(input: string): Url {\n  const match = urlRegex.exec(input)!;\n  return makeUrl(\n    match[1],\n    match[2] || '',\n    match[3],\n    match[4] || '',\n    match[5] || '/',\n    match[6] || '',\n    match[7] || '',\n  );\n}\n\nfunction parseFileUrl(input: string): Url {\n  const match = fileRegex.exec(input)!;\n  const path = match[2];\n  return makeUrl(\n    'file:',\n    '',\n    match[1] || '',\n    '',\n    isAbsolutePath(path) ? path : '/' + path,\n    match[3] || '',\n    match[4] || '',\n  );\n}\n\nfunction makeUrl(\n  scheme: string,\n  user: string,\n  host: string,\n  port: string,\n  path: string,\n  query: string,\n  hash: string,\n): Url {\n  return {\n    scheme,\n    user,\n    host,\n    port,\n    path,\n    query,\n    hash,\n    type: UrlType.Absolute,\n  };\n}\n\nfunction parseUrl(input: string): Url {\n  if (isSchemeRelativeUrl(input)) {\n    const url = parseAbsoluteUrl('http:' + input);\n    url.scheme = '';\n    url.type = UrlType.SchemeRelative;\n    return url;\n  }\n\n  if (isAbsolutePath(input)) {\n    const url = parseAbsoluteUrl('http://foo.com' + input);\n    url.scheme = '';\n    url.host = '';\n    url.type = UrlType.AbsolutePath;\n    return url;\n  }\n\n  if (isFileUrl(input)) return parseFileUrl(input);\n\n  if (isAbsoluteUrl(input)) return parseAbsoluteUrl(input);\n\n  const url = parseAbsoluteUrl('http://foo.com/' + input);\n  url.scheme = '';\n  url.host = '';\n  url.type = input\n    ? input.startsWith('?')\n      ? UrlType.Query\n      : input.startsWith('#')\n      ? UrlType.Hash\n      : UrlType.RelativePath\n    : UrlType.Empty;\n  return url;\n}\n\nfunction stripPathFilename(path: string): string {\n  // If a path ends with a parent directory \"..\", then it's a relative path with excess parent\n  // paths. It's not a file, so we can't strip it.\n  if (path.endsWith('/..')) return path;\n  const index = path.lastIndexOf('/');\n  return path.slice(0, index + 1);\n}\n\nfunction mergePaths(url: Url, base: Url) {\n  normalizePath(base, base.type);\n\n  // If the path is just a \"/\", then it was an empty path to begin with (remember, we're a relative\n  // path).\n  if (url.path === '/') {\n    url.path = base.path;\n  } else {\n    // Resolution happens relative to"510758",
        "510843",
        "510974",
        "511021",
        "511053",
        "511068",
        "511086",
        "511227",
        "511259",
        "511264",
        "511431",
        "511432",
        "511433",
        "511446",
        "511514",
        "511525",
        "511572",
        "511752",
        "511777",
        "511785",
        "511807",
        "511869",
        "511899",
        "511902",
        "511905",
        "511924",
        "511938",
        "511960",
        "511985",
        "512063",
        "512110",
        "512129",
        "512130",
        "512186",
        "512230",
        "512241",
        "512242",
        "512268",
        "512278",
        "512799",
        "512823",
        "512862",
        "512996",
        "513033",
        "513046",
        "513205",
        "513227",
        "513236",
        "513254",
        "513255",
        "513266",
        "513289",
        "513382",
        "513410",
        "513638",
        "513707",
        "513793",
        "513882",
        "513885",
        "513887",
        "513888",
        "513889",
        "513891",
        "513897",
        "513907",
        "513985",
        "514013",
        "514015",
        "514022",
        "514029",
        "514049",
        "514059",
        "514229",
        "514257",
        "514271",
        "514287",
        "514306",
        "514474",
        "514688",
        "514719",
        "514724",
        "514794",
        "514855",
        "514886",
        "514900",
        "514901",
        "514976",
        "514990",
        "515000",
        "515063",
        "515075",
        "515106",
        "515198",
        "515232",
        "515313",
        "515374",
        "515383",
        "515558",
        "515692",
        "515735",
        "515856",
        "515910",
        "515959",
        "515980",
        "516013",
        "516014",
        "516071",
        "516135",
        "516188",
        "516199",
        "516224",
        "516266",
        "516304",
        "516413",
        "516425",
        "516437",
        "516452",
        "516493",
        "516565",
        "516580",
        "516652",
        "516666",
        "516676",
        "516718",
        "517002",
        "517140",
        "517156",
        "517178",
        "517180",
        "517223",
        "517326",
        "517330",
        "517539",
        "517605",
        "517685",
        "517697",
        "517763",
        "517767",
        "517777",
        "517800",
        "517835",
        "517847",
        "517922",
        "517933",
        "517996",
        "518076",
        "518081",
        "518088",
        "518129",
        "518177",
        "518367",
        "518441",
        "518481",
        "518531",
        "518700",
        "518747",
        "518913",
        "518941",
        "519094",
        "519100",
        "519101",
        "519105",
        "519146",
        "519206",
        "519270",
        "519321",
        "519442",
        "519450",
        "519605",
        "519695",
        "519726",
        "519727",
        "519731",
        "519732",
        "519752",
        "519824",
        "519846",
        "519945",
        "519949",
        "519991",
        "520077",
        "520125",
        "520182",
        "520205",
        "520316",
        "520337",
        "520369",
        "520502",
        "520534",
        "520572",
        "520600",
        "520602",
        "520607",
        "520702",
        "520738",
        "521131",
        "521138",
        "521161",
        "521267",
        "521301",
        "521322",
        "521328",
        "521332",
        "521335",
        "521336",
        "521341",
        "521379",
        "521382",
        "521481",
        "521507",
        "521510",
        "521515",
        "521527",
        "521531",
        "521601",
        "521602",
        "521611",
        "521613",
        "521614",
        "521620",
        "521621",
        "521630",
        "521640",
        "521641",
        "521650",
        "521660",
        "521670",
        "521671",
        "521680",
        "521756",
        "521810",
        "521849",
        "521876",
        "521882",
        "522228",
        "522269",
        "522301",
        "522341",
        "522343",
        "522353",
        "522364",
        "522367",
        "522654",
        "522709",
        "522717",
        "522735",
        "522750",
        "522769",
        "522906",
        "522933",
        "522935",
        "522977",
        "522999",
        "523079",
        "523081",
        "523087",
        "523093",
        "523222",
        "523241",
        "523245",
        "523409",
        "523464",
        "523468",
        "523484",
        "523525",
        "523548",
        "523569",
        "523644",
        "523652",
        "523653",
        "523686",
        "523726",
        "523737",
        "523754",
        "523762",
        "523788",
        "523798",
        "523808",
        "523859",
        "523993",
        "524030",
        "524038",
        "524048",
        "524059",
        "524099",
        "524400",
        "524413",
        "524415",
        "524478",
        "524656",
        "524664",
        "524718",
        "524757",
        "524762",
        "524777",
        "524822",
        "524823",
        "524841",
        "524849",
        "524860",
        "524866",
        "524867",
        "524924",
        "524928",
        "524932",
        "524936",
        "524937",
        "525307",
        "525363",
        "525421",
        "525437",
        "525438",
        "525441",
        "525447",
        "525475",
        "525478",
        "525484",
        "525606",
        "525607",
        "525637",
        "525697",
        "525717",
        "525722",
        "525749",
        "525993",
        "526102",
        "526114",
        "526126",
        "526143",
        "526146",
        "526149",
        "526207",
        "526264",
        "526283",
        "526288",
        "526308",
        "526311",
        "526434",
        "526473",
        "526484",
        "526524",
        "526824",
        "526956",
        "527077",
        "527079",
        "527101",
        "527168",
        "527175",
        "527184",
        "527193",
        "527215",
        "527321",
        "527355",
        "527553",
        "527664",
        "527670",
        "527675",
        "527693",
        "527725",
        "527778",
        "527845",
        "527854",
        "527868",
        "527869",
        "528092",
        "528212",
        "528213",
        "528291",
        "528445",
        "528466",
        "528469",
        "528473",
        "528544",
        "528546",
        "528556",
        "528559",
        "528563",
        "528564",
        "528567",
        "528568",
        "528623",
        "528752",
        "528772",
        "528814",
        "528844",
        "528888",
        "528898",
        "528916",
        "528923",
        "528924",
        "528928",
        "528934",
        "528935",
        "528955",
        "529003",
        "529004",
        "529044",
        "529079",
        "529104",
        "529171",
        "529277",
        "529306",
        "529307",
        "529308",
        "529334",
        "529366",
        "529401",
        "529463",
        "529540",
        "529857",
        "529873",
        "529921",
        "529944",
        "530009",
        "530053",
        "530090",
        "530098",
        "530173",
        "530320",
        "530511",
        "530585",
        "530589",
        "530705",
        "530782",
        "530790",
        "530791",
        "530833",
        "530854",
        "530878",
        "530882",
        "530885",
        "530888",
        "530889",
        "530890",
        "530892",
        "530893",
        "530894",
        "530895",
        "530896",
        "530897",
        "530898",
        "530899",
        "530902",
        "530904",
        "530908",
        "530952",
        "530953",
        "530968",
        "531033",
        "531380",
        "531481",
        "531490",
        "531532",
        "531590",
        "531679",
        "531703",
        "531724",
        "531815",
        "531816",
        "531840",
        "531842",
        "531843",
        "531900",
        "531942",
        "531980",
        "531988",
        "532010",
        "532159",
        "532211",
        "532445",
        "532652",
        "532721",
        "532740",
        "532777",
        "532914",
        "533030",
        "533038",
        "533085",
        "533086",
        "533087",
        "533091",
        "533092",
        "533202",
        "533402",
        "533466",
        "533592",
        "533702",
        "533956",
        "533972",
        "533976",
        "534051",
        "534053",
        "534181",
        "534242",
        "534348",
        "534435",
        "534466",
        "534475",
        "534530",
        "534607",
        "534610",
        "534611",
        "534636",
        "534770",
        "534883",
        "535055",
        "535105",
        "535824",
        "535897",
        "535905",
        "536121",
        "536129",
        "536165",
        "536284",
        "536291",
        "536293",
        "536296",
        "536312",
        "536313",
        "536314",
        "536315",
        "536319",
        "536455",
        "536544",
        "536584",
        "536651",
        "536654",
        "536655",
        "536658",
        "536681",
        "536682",
        "536684",
        "536809",
        "536811",
        "536812",
        "536815",
        "536816",
        "536818",
        "536819",
        "536821",
        "536823",
        "536824",
        "536842",
        "536914",
        "536915",
        "536924",
        "536925",
        "536947",
        "536962",
        "537078",
        "537089",
        "537100",
        "537740",
        "537948",
        "537953",
        "537955",
        "537956",
        "537958",
        "537959",
        "537961",
        "537982",
        "538104",
        "538130",
        "538132",
        "538134",
    